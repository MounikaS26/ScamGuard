{% extends "base.html" %}
{% block title %}Admin Dashboard - ScamGuard{% endblock %}
{% block content %}
<div class="card">
  <h1 class="center">Admin Dashboard ğŸ‘‘</h1>
  <p class="sub center">Manage users and monitor system activity.</p>

  <!-- é¡¶éƒ¨æŒ‰é’® -->
  <div class="button-grid" style="margin-top: 1.5rem;">
    <a href="{{ url_for('check_job') }}" class="btn btn-primary">ğŸ§  Go to Job Detector</a>
  </div>

  <h3 class="center" style="margin-top: 2rem;">Registered Users</h3>

  <div class="table-container" style="overflow-x: auto; margin-top: 1rem;">
    <table class="styled-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr class="user-row">
          <td>{{ user.id }}</td>
          <td>{{ user.Name }}</td>
          <td>{{ user.Email }}</td>
          <td>
            {% if user.Permission_level|int >= 1 %}
              <span class="role-admin">Admin</span>
            {% else %}
              <span class="role-user">User</span>
            {% endif %}
          </td>
          <td>
            {% if user.Permission_level|int >= 1 %}
              <span class="text-muted">ğŸ”’ Not Editable</span>
            {% else %}
              <a href="{{ url_for('account.edit_user', user_id=user.id) }}" class="btn btn-sm btn-primary">âœï¸ Edit</a>
            {% endif %}
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="5" class="center muted">No users found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination Controls -->
  <div id="pagination" class="center" style="margin-top: 1.5em;"></div>
</div>

<style>
/* è¡¨æ ¼ç»Ÿä¸€é£æ ¼ */
.styled-table {
  width: 100%;
  border-collapse: collapse;
  border-radius: 0.5rem;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  font-size: 0.95rem;
}

.styled-table th, .styled-table td {
  padding: 0.75rem 1rem;
  text-align: left;
  border-bottom: 1px solid var(--border, #e5e7eb);
}

.styled-table thead {
  background-color: var(--primary, #007bff);
  color: #fff;
}

.styled-table tbody tr:nth-child(even) {
  background-color: var(--bg2, #f9fafb);
}

.role-admin {
  color: var(--primary, #007bff);
  font-weight: 600;
}

.role-user {
  color: var(--success, #28a745);
  font-weight: 600;
}

/* æŒ‰é’®å°æ ·å¼ */
.btn-sm {
  padding: 0.25rem 0.5rem;
  font-size: 0.85rem;
  border-radius: 0.375rem;
}

/* åˆ†é¡µæŒ‰é’® */
#pagination button {
  cursor: pointer;
  transition: background 0.2s;
}
</style>

<script>
const rowsPerPage = 5;
const rows = Array.from(document.querySelectorAll(".user-row"));
const pagination = document.getElementById("pagination");
const totalPages = Math.ceil(rows.length / rowsPerPage);

function renderPage(page) {
  rows.forEach((row, i) => {
    row.style.display = (i >= (page - 1) * rowsPerPage && i < page * rowsPerPage) ? "" : "none";
  });
  renderPagination(page);
}

function renderPagination(page) {
  pagination.innerHTML = "";
  if (totalPages <= 1) return;

  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    btn.className = "btn btn-sm " + (i === page ? "btn-primary" : "btn-muted");
    btn.style.margin = "0 4px";
    btn.onclick = () => renderPage(i);
    pagination.appendChild(btn);
  }
}

renderPage(1);
</script>
{% endblock %}
